#!/bin/zshzsh

if [ `whoami` != 'root' ]
then
    echo "Run as root"
    exit
fi

if [ -e /sys/firmware/efi/efivars ]
then
    echo "Uefi boot mode! Cann't procced"
    exit
fi


USER='alby'
HOSTNAME='arch'
TIMEZONE='Asia/Kolkata'
KERNEL='linux-lts'
PENDRIVE='--removable'


read "?Enter a password for the user: " PASS1
read "?Re-enter password :" PASS2
until [ "$PASS1" = "$PASS2" ]
do
	unset PASS1 PASS2
	read "?Enter a password for the user: " PASS1
	read "?Re-enter password :" PASS2
done


ln -sf /usr/share/zoneinfo/$TIMEZONE /etc/localtime
hwclock --systohc

echo "en_US.UTF-8 UTF-8" >/etc/locale.gen
echo "en_US ISO-8859-1" >>/etc/locale.gen
locale-gen
echo "LANG=en_US.UTF-8" >/etc/locale.conf


echo $HOSTNAME >/etc/hostname
echo "127.0.0.1 localhost" >/etc/hosts


pacman --noconfirm -S grub intel-ucode
grub-install $(cat /disk.txt) $PENDRIVE --recheck
sed -i "/GRUB_TIMEOUT_STYLE/c\GRUB_TIMEOUT_STYLE=hidden" /etc/default/grub
grub-mkconfig -o /boot/grub/grub.cfg


pacman --noconfirm -S networkmanager
systemctl enable NetworkManager


if [ -d /home/$USER ]
then
    cd /home/$USER
    OLD=$(date +'%b%d')
    mkdir $OLD

    DIR=(. .. aud code dl doc dt phone pic vid)
    DIR+=(.vim .gnupg .password-store .stardict)

    ALL=($(ls -a))
    MOV=($(printf "%s\n" $DIR $ALL | sort | uniq -u))

    mv $MOV $OLD
    cd
fi


useradd -m -g wheel -s /bin/zsh $USER
echo "$USER:$PASS1" | chpasswd
echo "root:$PASS1" | chpasswd
echo "%wheel ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers
